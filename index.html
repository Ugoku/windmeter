<!DOCTYPE html>
<html>
<head lang="en">
	<meta charset="UTF-8">
	<title>Wind meter</title>
	<link rel="stylesheet" href="windmeter.css">
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
	<div>
		<meter id="windspeed" max="50" value=0></meter>
		<!--<meter id="winddirection" max="359"></meter>-->
		<span id="winddirection">⇩</span>
		<meter id="temperature" max="50" min="-50" value=0></meter>
	</div>
	<div>
		<output id="windspeed-txt"></output>
		<output id="winddirection-txt"></output>
		<output id="temperature-txt"></output>
	</div>
	<button id="js-stop">Stop</button>
	<script>
		var source = new EventSource('stream.php');
		source.addEventListener('message', function(e) {
			var wind = JSON.parse(e.data);

			document.getElementById('windspeed').value = wind.windspeed;
			document.getElementById('windspeed-txt').value = 'Wind speed: ' + wind.windspeed + 'kt';

			document.getElementById('winddirection').style.transform ='rotate(' + wind.winddir + 'deg)';
			document.getElementById('winddirection-txt').value = 'Direction: ' + wind.winddir + '°';

			document.getElementById('temperature').value = wind.temp;
			document.getElementById('temperature-txt').value = 'Temperature: ' + wind.temp + '°';
		}, false);
		document.getElementById('js-stop').addEventListener('click', function(){
			source.close();
		});
	</script>
</body>
</html>